---
title: "快適で超高速GAS開発"
date: 2022-12-17T23:59:59+09:00
draft: false
toc: true
---

# はじめに

この記事は「[UEC Advent Calendar 2022](https://adventar.org/calendars/7581)」17日目の記事です。遅刻しているのでマッハで書いています。さっきまで電気通信大学のサークルの一つであるバーチャルライブ研究会が主催する[MIKUEC 2022](https://mikuec.com/2022)でペンライトを降っていました。日曜日の公演も残席があるようなので良ければ行ってみてください。久しぶりにサイトを訪問したらめちゃくちゃおしゃれになってて驚きました。こんなセンスもりもりのサイト作ってみたい。

16日目の記事はつまみ([@TrpFrog])さんの『[たくさん展望台に登りたい !](https://trpfrog.net/blog/skyscraper-walk)』でした。
この徒歩企画には僕も誘われていたのですがサークルの仕事があったので参加できませんでした。😭
丸ビルの上に展望ロビーがあることを知らなかったので今度行ってみたいと思います。

こんにちは、あずきバー
([@azukibar_D](https://twitter.com/azukibar_D))です。TypeScriptとGoに興味があります。

最近Google Apps Scriptで書かれたメール転送スクリプトを改善する機会がありました。
完成品は[ここ](https://github.com/ueckoken/gmail-discord-notifier/)です。

機能追加をするついでにTypeScriptに変更してGitHub Actionsでデプロイするようになったら快適になったのでやったこと振り返りです。

# 従来の Google Apps Script 開発の辛いところ

Google Apps
Script（長いので以下GASと表記）はGoogleが提供している便利サービスの一つです。GASを使うとGmailからいい感じにメールを取得したりGoogle
スプレッドシートを簡単なデータベースとして遊んだりできます。

GASを書くには公式のオンラインエディタを使うのが一般的かと思います。しかしこの手法にはいくつかの問題があります。
一つ目はコードを修正したいときに実運用されているコードに手を入れないといけないという問題です。
例えばトリガーにて1分ごとに実行しているコードだと、コードの編集をすることによって不正なコードが実行される可能性があります。このようなことはできれば避けたいです。

二つ目はコードを流用したいときにGAS上にあると他の人のコードが再利用できないということです。コードがGAS上で管理されていることでこの問題は発生します。

[^1]: Google Apps Scriptのリファレンス。一例としてGmail Serviceのリファレンスを取りあげた。
[https://developers.google.com/apps-script/reference/gmail](https://developers.google.com/apps-script/reference/gmail)

# 解決しよう

これらの問題を解決するためにGitHubを用いてスクリプトを管理することにしました。またGitHub Actionsを用いて自動でデプロイすることにしました。

## GitHubで管理

まあこれに関しては大したことないです。デプロイされているコードをコピペしてGitHubに載せました。

## GitHub Actionsでデプロイ

こっちがメインです。[google/clasp](https://github.com/google/clasp)とGitHub Actionsでデプロイすることにしました。

mainブランチにpushしたときにclaspのコマンドを適当に叩くようにしました。いつも通りです。

このおかげでデプロイする手間が省けるので開発に対するハードルが低く感じます。GitHubを用いたいつも通りの開発フローを取りやすいのも利点かも知れません。

## TypeScript化

claspを用いるとTypeScriptをトランスパイルしてデプロイすることができます。ということでついでに元からあるスクリプトをTypeScriptにしました。

面倒だったので[airbng/ts-migrate](https://github.com/airbnb/ts-migrate)を用いて機械的にやってもらいました。このスクリプトを使うといい感じに関数引数の型を`any`型にしてくれます。あとはちまちま直していくだけです。あとは徐々に厳しく型を付けていきましょう。

`string`型と`number`型があるだけでも大分幸せになれたので今後もTypeScript化を積極的に進めていきたいと思います。ただ今回はコードが少なかったからそう思っただけである程度増えていくと厳しいかもしれないです。

ちなみにclaspがトランスパイルしてくれたコードはおそらくES5互換になっていて、考古学みたいな視点で眺めるととても面白いです。（テンプレート文字列がないので`concat`で無理やり文字列結合していたり、`const`使っていなかったりしている）

# おわりに

以上です。遅刻した上に中身が少ない記事で大変申し訳ないです。

18日目の記事はまどさんの『 文字キーの同時押しを別のキーに割り当てることについて書きます。』です。僕もスペースキーとA-Zキーを同時押しするとスペースキーがShiftキーとしてふるまう機能を使っているので記事が楽しみです。
